<!doctype html>
<html>
<head>
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>

<header class="site-header">
  <!-- reuse same header -->
</header>

<main class="page container">
  <button
    class="btn btn-ghost"
    style="margin-bottom: 16px;"
    onclick="goBack()"
  >
    ‚Üê Back
  </button>

  <h1>Notifications</h1>
  <div id="list"></div>
</main>

<script src="assets/js/main.js"></script>
<script>
const API = "http://127.0.0.1:8000";

async function loadNotifications(){
  const res = await fetch(`${API}/notifications/`, {
    headers: { "Authorization": `Bearer ${getToken()}` }
  });

  const data = await res.json();
  const list = document.getElementById("list");
  list.innerHTML = "";

  data.forEach(n => {
    const div = document.createElement("div");
    div.className = "card";
    if(!n.is_read) div.style.borderColor = "#2347ff";

    div.innerHTML = `
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px">
        <div>
          <p><strong>${formatNotificationText(n)}</strong></p>
          <small>${new Date(n.created_at).toLocaleString()}</small>
        </div>

        <button class="btn btn-ghost">View</button>
      </div>
    `;

    div.querySelector("button").onclick = async (e) => {
  e.stopPropagation();

  await fetch(`${API}/notifications/${n.id}/read`, {
    method: "POST",
    headers: { "Authorization": `Bearer ${getToken()}` }
  });

  window.location.href = `report.html?id=${n.report_id}`;
};


    div.onclick = async () => {
      await fetch(`${API}/notifications/${n.id}/read`, {
        method: "POST",
        headers: { "Authorization": `Bearer ${getToken()}` }
      });
      window.location.href = `report.html?id=${n.report_id}`;
    };

    list.appendChild(div);
  });
}

requireAuth();

function formatNotificationText(n) {
  if (n.type === "like") return `${n.actor} liked your report`;
  if (n.type === "dislike") return `${n.actor} disliked your report`;
  if (n.type === "comment") return `${n.actor} commented on your report`;
  return "New notification";
}

function goBack() {
  if (window.history.length > 1) {
    window.history.back();
  } else {
    window.location.href = "index.html";
  }
}



loadNotifications();
</script>
</body>
</html>
